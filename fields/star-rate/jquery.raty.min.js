!function(t){"use strict";var a={init:function(s){return this.each((function(){this.self=t(this),a.destroy.call(this.self),this.opt=t.extend(!0,{},t.fn.raty.defaults,s),a._adjustCallback.call(this),a._adjustNumber.call(this),"img"!==this.opt.starType&&a._adjustStarType.call(this),a._adjustPath.call(this),a._createStars.call(this),this.opt.cancel&&a._createCancel.call(this),this.opt.precision&&a._adjustPrecision.call(this),a._createScore.call(this),a._apply.call(this,this.opt.score),a._target.call(this,this.opt.score),this.opt.readOnly?a._lock.call(this):(this.style.cursor="pointer",a._binds.call(this)),this.self.data("options",this.opt)}))},_adjustCallback:function(){for(var t=["number","readOnly","score","scoreName"],a=0;a<t.length;a++)"function"==typeof this.opt[t[a]]&&(this.opt[t[a]]=this.opt[t[a]].call(this))},_adjustNumber:function(){this.opt.number=a._between(this.opt.number,1,this.opt.numberMax)},_adjustPath:function(){this.opt.path=this.opt.path||"",this.opt.path&&"/"!==this.opt.path.charAt(this.opt.path.length-1)&&(this.opt.path+="/")},_adjustPrecision:function(){this.opt.half=!0,this.opt.targetType="score"},_adjustStarType:function(){this.opt.path="";for(var t=["cancelOff","cancelOn","starHalf","starOff","starOn"],a=0;a<t.length;a++)this.opt[t[a]]=this.opt[t[a]].replace(".","-")},_apply:function(t){a._fill.call(this,t),t&&(t>0&&this.score.val(a._between(t,0,this.opt.number)),a._roundStars.call(this,t))},_between:function(t,a,s){return Math.min(Math.max(parseFloat(t),a),s)},_binds:function(){this.cancel&&(a._bindOverCancel.call(this),a._bindClickCancel.call(this),a._bindOutCancel.call(this)),a._bindOver.call(this),a._bindClick.call(this),a._bindOut.call(this)},_bindClick:function(){var a=this;a.stars.on("click.raty",(function(s){var e=t(this);a.score.val(a.opt.half||a.opt.precision?a.self.data("score"):this.alt||e.data("alt")),a.opt.click&&a.opt.click.call(a,+a.score.val(),s)}))},_bindClickCancel:function(){var t=this;t.cancel.on("click.raty",(function(a){t.score.removeAttr("value"),t.opt.click&&t.opt.click.call(t,null,a)}))},_bindOut:function(){var t=this;t.self.on("mouseleave.raty",(function(s){var e=+t.score.val()||void 0;a._apply.call(t,e),a._target.call(t,e,s),t.opt.mouseout&&t.opt.mouseout.call(t,e,s)}))},_bindOutCancel:function(){var a=this;a.cancel.on("mouseleave.raty",(function(s){var e=t(this),i=a.opt.path+a.opt.cancelOff;if("img"===a.opt.starType)e.attr("src",i);else{var o=a.opt.path+a.opt.cancelOn;e.removeClass(o).addClass(i)}if(a.opt.mouseout){var r=+a.score.val()||void 0;a.opt.mouseout.call(a,r,s)}}))},_bindOver:function(){var t=this,s=t.opt.half?"mousemove.raty":"mouseover.raty";t.stars.on(s,(function(s){var e=a._getScoreByPosition.call(t,s,this);a._fill.call(t,e),t.opt.half&&(a._roundStars.call(t,e),t.self.data("score",e)),a._target.call(t,e,s),t.opt.mouseover&&t.opt.mouseover.call(t,e,s)}))},_bindOverCancel:function(){var s=this;s.cancel.on("mouseover.raty",(function(e){var i=s.opt.path+s.opt.cancelOn,o=t(this),r=s.opt.path+s.opt.starOff;if("img"===s.opt.starType)o.attr("src",i),s.stars.attr("src",r);else{s.stars.attr("class",r);var n=s.opt.path+s.opt.cancelOff;o.removeClass(n).addClass(i).css("color",s.opt.starColor)}a._target.call(s,null,e),s.opt.mouseover&&s.opt.mouseover.call(s,null)}))},_buildScoreField:function(){return t("<input />",{name:this.opt.scoreName,type:"hidden"}).appendTo(this)},_createCancel:function(){var a=this.opt.path+this.opt.cancelOff,s=t("<"+this.opt.starType+" />",{title:this.opt.cancelHint,class:"raty-cancel"}).css("marginRight",this.opt.space?this.opt.spaceWidth+"px":"0");"img"===this.opt.starType?s.attr({src:a,alt:"x"}):s.attr("data-alt","x").addClass(a),"left"===this.opt.cancelPlace?this.self.prepend("&#160;").prepend(s):this.self.append("&#160;").append(s),this.cancel=s},_createScore:function(){var s=t(this.opt.targetScore);this.score=s.length?s:a._buildScoreField.call(this)},_createStars:function(){for(var s=1;s<=this.opt.number;s++){var e,i=this.opt.score&&this.opt.score>=s?"starOn":"starOff",o=a._getHint.call(this,s);i=this.opt.path+this.opt[i],(e="img"!==this.opt.starType?{"data-alt":s,class:i}:{src:i,alt:s}).title=o,t("<"+this.opt.starType+" />",e).css("marginRight",s<this.opt.number&&this.opt.space?this.opt.spaceWidth+"px":"0").appendTo(this),this.opt.space}this.stars=this.self.children(this.opt.starType)},_error:function(a){t(this).text(a),t.error(a)},_fill:function(t){for(var s=0,e=1;e<=this.stars.length;e++){var i,o=this.stars.eq(e-1),r=a._turnOn.call(this,e,t);if(this.opt.iconRange&&this.opt.iconRange.length>s){var n=this.opt.iconRange[s];i=a._getIconRange.call(this,n,r),e<=n.range&&("img"===this.opt.starType?o.attr("src",i):o.attr("class",i)),e===n.range&&s++}else i=this.opt.path+this.opt[r?"starOn":"starOff"],"img"===this.opt.starType?o.attr("src",i):o.attr("class",i),r?o.css("color",this.opt.starColor):o.css("color","")}},_getIconRange:function(t,a){return this.opt.path+(a?t.on||this.opt.starOn:t.off||this.opt.starOff)},_getScoreByPosition:function(s,e){var i=t(e),o=parseInt(e.alt||i.data("alt"),10);if(this.opt.half){var r=a._getSize.call(this),n=parseFloat((s.pageX-i.offset().left)/r);o=this.opt.precision?o-1+n:o-1+(n>.5?1:.5)}return o},_getSize:function(){var t;return(t="img"===this.opt.starType?this.stars[0].width:parseFloat(this.stars.eq(0).css("font-size")))||a._error.call(this,"Could not be possible get the icon size!"),t},_turnOn:function(t,a){return this.opt.single?t===a:t<=a},_getHint:function(t){var a=this.opt.hints[t-1];return""===a?"":a||t},_lock:function(){var t=parseInt(this.score.val(),10),s=t?a._getHint.call(this,t):this.opt.noRatedMsg;this.style.cursor="",this.title=s,this.score.prop("readonly",!0),this.stars.prop("title",s),this.cancel&&this.cancel.hide(),this.self.data("readonly",!0)},_roundStars:function(t){var a=(t%1).toFixed(2);if(a>this.opt.round.down){var s="starOn";this.opt.halfShow&&a<this.opt.round.up?s="starHalf":a<this.opt.round.full&&(s="starOff");var e=this.stars[Math.ceil(t)-1];"img"===this.opt.starType?e.src=this.opt.path+this.opt[s]:e.style.className=this.opt[s]}},_target:function(s,e){if(this.opt.target){var i=t(this.opt.target);i.length||a._error.call(this,"Target selector invalid or missing!");var o=e&&"mouseover"===e.type;if(void 0===s)s=this.opt.targetText;else if(null===s)s=o?this.opt.cancelHint:this.opt.targetText;else{"hint"===this.opt.targetType?s=a._getHint.call(this,Math.ceil(s)):this.opt.precision&&(s=parseFloat(s).toFixed(1));var r=e&&"mousemove"===e.type;o||r||this.opt.targetKeep||(s=this.opt.targetText)}s&&(s=this.opt.targetFormat.toString().replace("{score}",s)),i.is(":input")?i.val(s):i.html(s)}},_unlock:function(){this.style.cursor="pointer",this.removeAttribute("title"),this.score.removeAttr("readonly"),this.self.data("readonly",!1);for(var t=0;t<this.opt.number;t++)this.stars[t].title=a._getHint.call(this,t+1);this.cancel&&this.cancel.css("display","")},cancel:function(s){return this.each((function(){var e=t(this);!0!==e.data("readonly")&&(a[s?"click":"score"].call(e,null),this.score.removeAttr("value"))}))},click:function(s){return this.each((function(){!0!==t(this).data("readonly")&&(a._apply.call(this,s),this.opt.click&&this.opt.click.call(this,s,t.Event("click")),a._target.call(this,s))}))},destroy:function(){return this.each((function(){var a=t(this),s=a.data("raw");s?a.off(".raty").empty().css({cursor:s.style.cursor}).removeData("readonly"):a.data("raw",a.clone()[0])}))},getScore:function(){var t,a=[];return this.each((function(){t=this.score.val(),a.push(t?+t:void 0)})),a.length>1?a:a[0]},move:function(s){return this.each((function(){var e=parseInt(s,10),i=t(this).data("options"),o=(+s).toFixed(1).split(".")[1];e>=i.number&&(e=i.number-1,o=10);var r=a._getSize.call(this)/10,n=t(this.stars[e]),l=n.offset().left+r*parseInt(o,10),c=t.Event("mousemove",{pageX:l});n.trigger(c)}))},readOnly:function(s){return this.each((function(){var e=t(this);e.data("readonly")!==s&&(s?(e.off(".raty").children("img").off(".raty"),a._lock.call(this)):(a._binds.call(this),a._unlock.call(this)),e.data("readonly",s))}))},reload:function(){return a.set.call(this,{})},score:function(){var s=t(this);return arguments.length?a.setScore.apply(s,arguments):a.getScore.call(s)},set:function(a){return this.each((function(){var s=t(this),e=s.data("options"),i=t.extend({},e,a);s.raty(i)}))},setScore:function(s){return this.each((function(){!0!==t(this).data("readonly")&&(a._apply.call(this,s),a._target.call(this,s))}))}};t.fn.raty=function(s){return a[s]?a[s].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof s&&s?void t.error("Method "+s+" does not exist!"):a.init.apply(this,arguments)},t.fn.raty.defaults={cancel:!1,cancelHint:"Cancel this rating!",cancelOff:"raty-cancel-off",cancelOn:"raty-cancel-on",cancelPlace:"left",click:void 0,half:!1,halfShow:!0,hints:["1"],iconRange:void 0,mouseout:void 0,mouseover:void 0,noRatedMsg:"Not rated yet!",number:5,numberMax:20,path:void 0,precision:!1,readOnly:!1,round:{down:.25,full:.6,up:.76},score:void 0,scoreName:"score",single:!1,space:!0,spaceWidth:3,starColor:"#ff00aa",starHalf:"star-half.png",starOff:"raty-dot-off",starOn:"raty-dot-on",starType:"img",target:void 0,targetFormat:"{score}",targetKeep:!1,targetScore:void 0,targetText:"",targetType:"hint"}}(jQuery);
